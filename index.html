<!DOCTYPE html>
  <html>
    <head>
      <title>
        GSoC 2016 DevLog
      </title>

        <!--Import custom stylesheet -->
    <link type="text/css" rel="stylesheet" href="css/index.css">

    <!--Import Google Icon Font-->
        <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

        <!--Import materialize.css-->
        <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>

    <!--Import Github Octicons -->
      <link rel="stylesheet" href="css/octicons/octicons.css">

        <!--Let browser know website is optimized for mobile-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>

    <body>
        <!--Import jQuery before materialize.js-->
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="js/materialize.min.js"></script>

      <header>
        <div class="brown darken-2 white-text z-depth-2">
          <div class="container">
            <div class="row">
              <div class="col s12">
                <h3>
                    <b>GSoC 2016 DevLog</b>
                  </h3>
                  <h6 style="margin-bottom: 15px">
                    Tracking project progress and contributions for TARDIS.
                  </h6>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main>
          <div class="container">

            <a class="gh-icon red lighten-1 btn-floating right btn-large z-depth-2"
              href="https://www.github.com/tardis-sn/tardis/commits/?author=karandesai-96" target="_blank">
              <i class="mega-octicon octicon-git-commit"></i>
            </a>

            <a class="gh-icon red lighten-1 btn-floating right btn-large z-depth-2"
              href="https://github.com/tardis-sn/tardis/pulls?utf8=%E2%9C%93&q=is%3Apr+author%3Akarandesai-96" target="_blank">
              <i class="mega-octicon octicon-git-pull-request"></i>
            </a>
            
            <a class="gh-icon red lighten-1 btn-floating right btn-large z-depth-2"
              href="https://github.com/tardis-sn/tardis/issues?utf8=%E2%9C%93&q=is%3Aissue+author%3Akarandesai-96" target="_blank">
              <i class="mega-octicon octicon-issue-opened"></i>
            </a>

            <a class="gh-icon red lighten-1 btn-floating right btn-large z-depth-2"
              href="https://www.github.com/karandesai-96/tardis" target="_blank">
              <i class="mega-octicon octicon-repo-clone"></i>
            </a>


            <!-- AND THE DEV LOG STARTS FROM HERE -->

            <ul class="collapsible popout" data-collapsible="expandable">

            <li>

              <div class="collapsible-header active waves-effect waves-light indigo darken-2 white-text">
                <i class="mega-octicon octicon-calendar"></i>
                <b>11 April - 8 May</b>
              </div>

              <div class="collapsible-body blue lighten-5">
                <ul class="details">
                  <li><b>Hiatus</b><br/>
                    My semester exams are held from 22 April to 2 May. Most of my time will be devoted to academics.
                  </li>

                  <li><b>Significant work</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/544">
                    <i class="octicon octicon-git-pull-request"></i><b>#544</b></a>:
                    Continued CMontecarlo tests refactor on this PR after the previous merge.
                  </li>
                  <li>
                    Faced unexpected segfaults in the C tests. The following reasons were assumed to cause the problem (they didn't):
                    <ul>
                      <li>
                        The new enumerates implementation was a problem and that they should be kept as <code> c_ints</code> or <code>c_uints</code>.
                      </li>
                      <li>
                        There might be racing problems in case of multithreading.
                      </li>
                      <li>
                        The <code>ctypes.Structure</code> class would be leaking memory while reassigning a pointer.
                      </li>
                    </ul>
                  </li>

                  <br/>

                  <li>
                  The conclusion based on these assumptions:
                    <ul>
                      <li>
                        The enumerate implementation was simplified, keeping readability intact - in 
                        <a href="https://github.com/tardis-sn/tardis/pull/547">
                        <i class="octicon octicon-git-pull-request"></i><b>#547</b></a>.
                      </li>
                      <li>
                        Tests ran on a single thread, this wasn't a problem.
                      </li>
                      <li>
                        I came to know about the memory leakage from a discussion in ctypes developers forum, but it was outdated. 
                        It corresponded to an older version, and this problem isn't existent now.
                      </li>
                    </ul>

                  <br/>

                  <li>
                    The actual problem and solution:
                    <ul>
                      <li>
                        RKState struct in python implementation had a 'key' member which was a pointer to c_ulong type array.
                        The C counterpart had a static array declaration, and hence the memory allocated to both Structs was different.
                      </li>
                      <li>
                        <code>mt_state</code> is a struct - so if an instance was declared, it would allocate (4*624 + 4 + 4 + 8) bytes 
                        in the stack (on 32 bit system) according to C struct. (4*624, 4, 4 and 8 are sizeof <code>key</code>, <code>pos</code>,
                        <code>has_gauss</code>, <code>gauss</code> in bytes, respectively).
                        According to python struct, it would be (4 + 4 + 4 + 8) bytes only - as the <code>key</code> is 4 btes long, a pointer
                        storing the address of the array, which is in heap and not in stack. So wrong memory was accessed everytime/
                      </li>
                      <li>
                        Fix for this problem can be seen in this 
                        <a href="https://github.com/tardis-sn/tardis/pull/544/commits/6b1855ac36b233d454b91bbefa580abd6223276f">commit</a>.
                        It modifies the <code>RKState</code> struct implemenation in python.
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </li>

            <li>
              <div class="collapsible-header waves-effect waves-light grey darken-2 white-text">
                <i class="mega-octicon octicon-calendar"></i>
                <b>4 April - 10 April</b>
              </div>

              <div class="collapsible-body grey lighten-5">
                <ul class="details">
                  <li><b>8-10 Apr:</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/530">
                    <i class="octicon octicon-git-pull-request"></i><b>#530</b></a>:
                    Work on PR according to reviews received. PR is now <b>merged.</b> Rest of the time spent in usual academics.
                  </li>

                  <br/>

                  <li><b>7 Apr:</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/530">
                    <i class="octicon octicon-git-pull-request"></i><b>#530</b></a>:
                    Add docstrings in <b>test_cmontecarlo.py</b>
                  </li>

                  <br/>

                  <li><b>5-6 Apr:</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/530">
                    <i class="octicon octicon-git-pull-request"></i><b>#530</b></a>:
                    Rebase and reword this PR.
                  </li>
                  <li>
                    Travis CI automerged this branch with master and ran the tests. Master was updated, henc my tests failed.
                  </li>

                  <br/>

                  <li><b>4 Apr:</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/530">
                    <i class="octicon octicon-git-pull-request"></i><b>#530</b></a>:
                    Wrote 'test_montecarlo_line_scatter'. Test cases are yet to be added.
                  </li>
                  <li>
                    Tried running tardis on Wercker CI and found that the build passed. Something wrong with the <b>travis.yml</b>
                  </li>
                </ul>
              </div>
            </li>


            <li>

              <div class="collapsible-header waves-effect waves-light indigo darken-2 white-text">
                <i class="mega-octicon octicon-calendar"></i>
                <b>28 March - 3 April</b>
              </div>
              
              <div class="collapsible-body blue lighten-5">
                <ul class="details">
                  <li><b>3 Apr:</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/530">
                    <i class="octicon octicon-git-pull-request"></i><b>#530</b></a>: 
                    Tried 'test_calculate_chi_bf' but scraped off as it was bad design.
                  </li>
                  <li>
                    Encountered weird travis issue so digged info on probable errors.
                  </li>

                  <br/>

                  <li><b>2 Apr:</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/530">
                    <i class="octicon octicon-git-pull-request"></i><b>#530</b></a>: 
                    Complete writing 'test_increment_j_blue_estimator'.
                  </li>

                  <br/>

                  <li><b>1 Apr:</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/527">
                    <i class="octicon octicon-git-pull-request"></i><b>#527</b></a>: 
                    Discussions and concluding commits made upon review of PR.
                  </li>
                  
                  <br/>

                  <li><b>31 Mar:</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/530">
                    <i class="octicon octicon-git-pull-request"></i><b>#530</b></a>: 
                    More tests: 'distance2line', 'distance2continuum' and 'rpacket_doppler_factor.'
                  </li>
                  
                  <br/>

                  <li><b>30 Mar:</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/530">
                    <i class="octicon octicon-git-pull-request"></i><b>#530</b></a>: 
                    Fix all bugs in python struct initialization and clean up code. Tentative finalization of 'test_compute_distance2boundary'.
                  </li>
                  
                  <br/>

                  <li><b>29 Mar:</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/530">
                    <i class="octicon octicon-git-pull-request"></i><b>#530</b></a>: 
                    Change the design technique of parametrization of tests.
                  </li>

                  <br/>

                  <li><b>28 Mar:</b><br/>
                    <a href="https://github.com/tardis-sn/tardis/pull/530">
                    <i class="octicon octicon-git-pull-request"></i><b>#530</b></a>: 
                    Further work on this PR. Parametrization of 'compute_distance2boundary' method is done.
                  </li>
                </ul>
              </div>
            </li>

            <li>
              <div class="collapsible-header waves-effect waves-light grey darken-2 white-text">
                <i class="mega-octicon octicon-calendar"></i>
                <b>25 March - 27 March</b>
              </div>
              
              <div class="collapsible-body blue-grey lighten-5">
                <ul class="details">

                  <li><b>27 Mar: </b>
                    Further read about <b>ctypes.Structure</b> and how it works, started refactoring one test in <b>test_cmontecarlo.py</b>.</li>
                  <li>
                    <a href="https://github.com/tardis-sn/tardis/pull/530">
                    <i class="octicon octicon-git-pull-request"></i><b>#530</b></a>: 
                    Opened this PR. Work so far mentioned in descriptions and body of first three commits.
                  </li>

                  <br/>

                  <li><b>26 Mar: </b>
                    Set this devlog up. Most of the day was spent in devlog setup and usual academics.</li>
                  <li>
                    <a href="https://github.com/tardis-sn/tardis/issues/249">
                    <i class="octicon octicon-issue-opened"></i><b>#249</b></a>: 
                    Viewed this and found it relevant to C code testing. Also saw some code in <b>test_cmontecarlo.py</b> to understand wrap/ expose technique used.</li>

                  <br/>

                  <li><b>25 Mar:</b><br/>
                    GSoC Proposal Submitted on Melange. 
                    <a href="https://drive.google.com/file/d/0B84aTiHkSG0QZmhrUEluS1FxZ0E/view?usp=sharing">[Link to Proposal]</a></li>
                </ul>
              </div>
            </li>

        </ul>
          </div>
      </main>
    </body>
  </html>
